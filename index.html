<html>
<head>
<script src="libraries/shp.js"></script>
<script src="libraries/topojson.js"></script>
<script src="libraries/d3.js" charset="utf-8"></script>
<script src="libraries/d3.min.js"></script>
<script src="http://maps.googleapis.com/maps/api/js"></script>
<script >

var map;
function initialize() {
      // set up the google map
     var mapOptions = {
    zoom: 6,
    center: new google.maps.LatLng(178, -16),
    mapTypeId: google.maps.MapTypeId.TERRAIN
      };
      //initializing the map
    map = new google.maps.Map(document.getElementById('googleMap'),mapOptions);
    console.log("executing");
    
    
    }
    

    
     //function from shp.js to convert shapefile to geojson
    shp("shapefiles/FJI_adm.zip").then(function(geojson){ 
    
    console.log(geojson[0]);
    
    //creating google map overlay
    overlay = new google.maps.OverlayView();
    overlay.draw = drawOverlay;    
    overlay.onAdd = addOverlay;
         

     overlay.setMap(map);
     
     function addOverlay(){
         console.log("executing addoverlay");
         //create D3 svg elements
         gm_svg_layer = d3.select(overlay.getPanes().overlayLayer)
                 .append("div")
                 .append("svg")
                 .append("g");
     }
     
     function drawOverlay(){
         //getting the current projection for the google map
         console.log("executing drawoverlay");
         gm_projection = overlay.getProjection();
         
         var gm_path = d3.geo.path().projection(gm_google_map_d3_projection);
         
         //standard D3 plotting
         console.log("standard d3 plotting");
         
         var gm_d3_map = gm_svg_layer.selectAll("path")
                    .data(geojson[0].features)
                    .attr("d", gm_path)
                    .enter();
                   
         gm_d3_map.append("path")
                 .attr("d",gm_path)
                 .attr("stroke","black")
                 .attr("opacity",0.5);
         
         console.log("finish executing drawoverlay");
     }
     
     
     function gm_google_map_d3_projection(coordinates){
         
         //translate google into D3
         console.log("executing gm_google_map_d3_projection");
         console.log(coordinates[0]);
         console.log(coordinates[1]);
         
         
         var googleCoordinates = new google.maps.LatLng(coordinates[1],coordinates[0]);
         
         var pixelCoordinates = gm_projection.fromLatLngToDivPixel(googleCoordinates);
         console.log("got coordinates");
         return [pixelCoordinates.x+4000,pixelCoordinates.y+4000];
         
     }
     
     
    
    });
    
    
     
     
     
     
    
    
    
    
    
    

   
    







//listener to load the google map 
google.maps.event.addDomListener(window, 'load', initialize);
 
</script>
</head>

<body>
<h1>The Visualizer</h1>
<p id="demo">Mapping made easy</p>



<div id="googleMap" style="width:1000px;height:500px;"></div>



<p id="demo"></p>

</body>
</html>