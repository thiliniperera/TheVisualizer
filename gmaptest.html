<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
         <script src="libraries/shp.js"></script>
        <script src="libraries/topojson.js"></script>
        <script src="libraries/d3.js" charset="utf-8"></script>
        <script src="libraries/d3.min.js"></script>
        <script src="js/jquery-1.11.3.min.js"></script>
         <script src="http://maps.googleapis.com/maps/api/js?sensor=true"></script>
        
            <script>
                var shapefile,overlay,gm_projection,map,dataset;
                
                
                shp("LKA_adm.zip").then(function(geoJSON) {
                         //console.log(geoJSON[0]);
                        shapefile = geoJSON[1];
                     });
                     
                 d3.csv("data.csv",function(error,data){
                    //asynchronous method, rest of your code is executed even while JavaScript is simultaneously waiting for the file to finish downloading into the browser.

                    if(error){
                      console.log(error);
                    }else{   
                      dataset = data;
                       

                    }
                });

                    
                
                function initialise(){
                    
                    
                
                // Create the Google Mapâ€¦
                 map = new google.maps.Map(d3.select("#googlemap").node(), {
                    
                  zoom: 4,
                  center: new google.maps.LatLng(7, 81),
                  mapTypeId: google.maps.MapTypeId.TERRAIN
                });
                
              
                overlay = new google.maps.OverlayView();
                
                overlay.onAdd =  function (){
                   
                 var layer = d3.select(this.getPanes().overlayLayer)
                        .append('div') 
                        .append('svg')
                        .attr('width', 1000)
                        .attr('height', 1000)  
                        .append('g');
                
                overlay.draw = function(){
                    
              
                        gm_projection = overlay.getProjection();

                       var gm_path = d3.geo.path().projection(gm_d3_map_proj);
                       var gm_d3_map= layer.selectAll("path")
                               .data(shapefile.features)
                               .attr("d",gm_path)
                               .enter();

                       gm_d3_map.append("path")
                               .attr("d",gm_path)
                               .attr("fill","steelblue")
                               .attr("opacity",0.4)
                               .attr("stroke","black")
                                .attr("stroke-width",3);

                       console.log("overlaydraw");
                       
                       
                        function gm_d3_map_proj(coordinates){
                                var google_coordinates = new google.maps.LatLng(coordinates[1],coordinates[0]);
                                var pixel_coordinates = gm_projection.fromLatLngToDivPixel(google_coordinates);

                                return [pixel_coordinates.x,pixel_coordinates.y];

                }
                
                console.log("overlayadd");
               };      
          };
               
                
              overlay.setMap(map);  
                
                
                
                
                
                }
               
               
             
            </script>
            
            <style>
                
            </style>
        
    </head>
    <body>
        <div id="googlemap" style="width:1000px;height:1000px;position:relative"></div>
    </body>
</html>
