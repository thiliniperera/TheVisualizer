<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Pie Chart</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="libraries/d3.js" charset="utf-8"></script>
    <script src="libraries/d3.min.js"></script>
    
        <style>
           
        </style>
    
    </head>
    <body>
         <h1>The Visuvalizer</h1>
         <input type="file" id="myFile" name="files[]" />
            
     <button onclick="loadFile()">Upload</button>
        <div id="chart" align="center" ></div>
        <div id="legend"></div>
        
            
        <script>
            
            var dataset;
            
     function loadFile(){
        
     var file = document.getElementById('myFile').files[0];
    if (file) {
    d3.csv(file.name,function(error,data){
        //asynchronous method, rest of your code is executed even while JavaScript is simultaneously waiting for the file to finish downloading into the browser.
               
        if(error){
            console.log(error);
        }else{   
            dataset = data;
            loadVisualization();            
        }
    });
    }else{
        alert("dispaly error msg, invalid input");
        
    }
    
    }
            
            
    function loadVisualization(){    
            
            var width = 400;
            var height = 560;
            var radius = Math.min(width, height) / 2;  
            
            //if the no of entries are more than 20 colours are reused.Do something for that -> change the scale
            var color = d3.scale.category20b();
            
            //select the div with id chart and add an svg
            var svg = d3.select('#chart') //retrieve the DOM element with id chart
                        .append('svg')  //append an svg element to the element we've selected.
                        .attr('width', width)  //set width
                        .attr('height', height) //set height
                        .append('g')    //append a group element to the svg element.
                        .attr('transform', 'translate(' + (width / 2) +  ',' + (height / 2) + ')'); //center the group in svg
            
            //outer radius of pie chart
            var arc = d3.svg.arc().outerRadius(radius);
            
            var pie = d3.layout.pie()   //the start and end angles of the segments
                        .value(function(d) { return d.Value; }) //extract the numerical data from each entry in our dataset
                        .sort(null);    //disable sorting of the entries
                
            var path = svg.selectAll('path') //select all path elements inside our svg,inside g
                            .data(pie(dataset)) //how we associate data with path, we use the pie function which will give values and angles
                            .enter()
                            .append('path')
                            .attr('d', arc)
                            .attr('fill', function(d) { 
                              return color(d.data.District); //colour scale to define the fill for each path by associating a colour with each label in the dataset.
                            });
                            
            //---------------------TEXT labels----------------
            
             var key = function(d){ return d.data.District; };
             
                        var text = svg.selectAll("text")
                                      .data(pie(data),key);

                        text.enter()
                                .append("text")
                                .attr("dy", ".35em")
                                .text(function(d) {
                                        return "abcd";
                                });
    }   
    
    
   
        </script>
  

    </body>
</html>
